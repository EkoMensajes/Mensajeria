<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Usuarios - PetWise Chat</title>
<style>
body { font-family:sans-serif; padding:1rem; background:#ece5dd; }
input { padding:0.5rem; width:100%; margin-bottom:1rem; border-radius:6px; border:1px solid #ccc; }
.usuario { padding:1rem; margin-bottom:0.5rem; border:1px solid #ccc; border-radius:8px; cursor:pointer; background:#fff; }
.usuario:hover { background:#f0f0f0; }
</style>
</head>
<body>

<h2>Usuarios</h2>
<input type="text" id="buscar" placeholder="Buscar por username">
<div id="usuariosList"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
const supabaseUrl = "https://qetfppqdlmyvvrd;redxy.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFldGZwcHFkbG15dnZyZHJlZHh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5Mjg4MTksImV4cCI6MjA3MjUwNDgxOX0.gt9Bgl5yAWA-XZ0DWJvb850XkJyi7d4CPNrwVaB0RdQ";
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

const usuariosList = document.getElementById("usuariosList");
const buscarInput = document.getElementById("buscar");
const myId = localStorage.getItem("user_id");

async function cargarUsuarios(filtro = "") {
  let query = supabase.from("usuarios").select("*").neq("id", myId);
  if(filtro) query = query.ilike("username", `%${filtro}%`);
  
  const { data, error } = await query;
  if(error) return alert(error.message);

  usuariosList.innerHTML = "";
  data.forEach(u => {
    const div = document.createElement("div");
    div.className = "usuario";
    div.textContent = u.username + " (" + (u.full_name || "") + ")";
    div.addEventListener("click", () => {
      window.location.href = "chat.html?to=" + u.id;
    });
    usuariosList.appendChild(div);
  });
}

// BÃºsqueda en tiempo real
buscarInput.addEventListener("input", () => {
  const filtro = buscarInput.value.trim();
  cargarUsuarios(filtro);
});

// Carga inicial
cargarUsuarios();
</script>
</body>
</html>
