<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Grupos PetWise</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { margin:0; font-family: sans-serif; background:#c2c2c2; padding-top:70px; }
.navbar { background:#048c96; color:#fff; }
.container { max-width:600px; margin:auto; padding:1rem; }
.grupo { display:flex; align-items:center; padding:12px; margin-bottom:12px; background:#fff; border-radius:12px; text-decoration:none; color:inherit; box-shadow:0 2px 5px rgba(0,0,0,0.08); }
.grupo:hover { box-shadow:0 4px 10px rgba(0,0,0,0.15); transform:translateY(-2px); }
.grupo img { width:55px; height:55px; border-radius:50%; margin-right:16px; object-fit:cover; border:2px solid #048c96; }
.grupo-nombre { font-weight:600; font-size:1.1rem; color:#333; }
.ultimo-mensaje { font-size:0.85rem; color:#666; margin-top:3px; }
.hora-mensaje { font-size:0.7rem; color:#999; margin-top:2px; }
</style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<nav class="navbar navbar-dark fixed-top">
  <div class="container-fluid px-4">
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img src="img/logo.png" alt="PetWise Logo" class="img-fluid" />
      <span>Grupos</span>
    </a>
  </div>
</nav>

<div class="container" id="gruposContainer"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
const supabaseUrl = "https://qetfppqdlmyvvrd;redxy.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFldGZwcHFkbG15dnZyZHJlZHh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY5Mjg4MTksImV4cCI6MjA3MjUwNDgxOX0.gt9Bgl5yAWA-XZ0DWJvb850XkJyi7d4CPNrwVaB0RdQ";
const supabase = supabase.createClient(supabaseUrl, supabaseKey)

const grupos = [
  { id:"general", nombre:"Grupo General", img:"img/gatoperrocamara.webp" },
  { id:"noticias", nombre:"Grupo de Noticias", img:"img/perroimg.png" },
  { id:"empresa", nombre:"Grupo PetWise", img:"img/logo2.png" }
];

function horaLocal(timestamp){ return new Date(timestamp).toLocaleTimeString([], {hour:"2-digit", minute:"2-digit", hour12:false}); }

async function cargarGrupos(){
  const container = document.getElementById("gruposContainer");
  container.innerHTML = "";
  for(const g of grupos){
    const { data, error } = await supabase.from("mensajes")
      .select("*, usuario:usuario_id(nombre)")
      .eq("grupo", g.id)
      .order("created_at", { ascending:false })
      .limit(1)
      .single();

    let ultimoMensaje = "Sin mensajes aún...";
    let horaMensaje = "";
    if(data){
      ultimoMensaje = `${data.usuario?.nombre || "Anónimo"}: ${data.contenido}`;
      horaMensaje = horaLocal(data.created_at);
    }

    const a = document.createElement("a");
    a.href = `chat.html?grupo=${g.id}`;
    a.className = "grupo";
    a.innerHTML = `
      <img src="${g.img}" alt="${g.nombre}">
      <div>
        <div class="grupo-nombre">${g.nombre}</div>
        <div class="ultimo-mensaje">${ultimoMensaje}</div>
        <div class="hora-mensaje">${horaMensaje}</div>
      </div>
    `;
    container.appendChild(a);
  }
}
cargarGrupos();
setInterval(cargarGrupos, 7000);
</script>
</body>
</html>
